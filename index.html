<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Car GPS Navigation</title>
<link rel="manifest" href="manifest.json">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
html,body{margin:0;height:100%;background:#000;font-family:system-ui}
#map{height:100%}
.hud{position:fixed;inset:0;display:flex;flex-direction:column;justify-content:space-between;z-index:999;pointer-events:none}
.panel{margin:10px;padding:14px;border-radius:18px;background:rgba(0,0,0,.8);color:#fff;pointer-events:auto}
.top{display:flex;justify-content:space-between;align-items:center}
.maneuver{font-size:18px;font-weight:700}
.speed{font-size:28px;font-weight:900}
.bottom{display:flex;gap:10px}
input,button{padding:12px;border-radius:14px;border:none;font-size:16px}
button{font-weight:700}
.lane{margin-top:6px;font-size:14px;opacity:.8}
</style>
</head>
<body>
<div id="map"></div>
<div class="hud">
  <div class="panel top">
    <div>
      <div id="maneuver" class="maneuver">Waiting for destination</div>
      <div id="lane" class="lane"></div>
    </div>
    <div>
      <div id="speed" class="speed">0</div>
      <div id="limit">‚Äî</div>
    </div>
  </div>
  <div class="panel bottom">
    <input id="search" placeholder="Where to?" />
    <button onclick="voiceSearch()">üé§</button>
    <button onclick="searchAddress()">Go</button>
    <button onclick="toggleMap()">üõ∞Ô∏è</button>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const map=L.map('map',{zoomControl:false}).setView([39.8,-98.6],4);
const street=L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
const sat=L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}');
let satellite=false;
function toggleMap(){satellite?(map.removeLayer(sat),street.addTo(map)):(map.removeLayer(street),sat.addTo(map));satellite=!satellite}

let marker,route,steps=[],stepIndex=0,trip=[];
const icon=L.divIcon({html:'<div style="width:14px;height:14px;background:#1a73e8;border:3px solid #fff;border-radius:50%"></div>',iconSize:[20,20]});

function speak(t){speechSynthesis.cancel();speechSynthesis.speak(new SpeechSynthesisUtterance(t));}

navigator.geolocation.watchPosition(p=>{
 const ll=[p.coords.latitude,p.coords.longitude];
 trip.push(ll);
 if(!marker){marker=L.marker(ll,{icon}).addTo(map);map.setView(ll,17)}
 else marker.setLatLng(ll);
 speed.textContent=p.coords.speed?Math.round(p.coords.speed*2.23694):0;
 if(steps[stepIndex]){
   maneuver.textContent=steps[stepIndex].maneuver.instruction;
   lane.textContent=steps[stepIndex].maneuver.type||'';
 }
},{enableHighAccuracy:true});

async function searchAddress(){
 const q=search.value;if(!q||!marker)return;
 const g=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}`).then(r=>r.json());
 buildRoute([+g[0].lat,+g[0].lon]);
}

async function buildRoute(dest){
 const s=marker.getLatLng();
 const r=await fetch(`https://router.project-osrm.org/route/v1/driving/${s.lng},${s.lat};${dest[1]},${dest[0]}?steps=true&geometries=geojson&overview=full`).then(r=>r.json());
 if(route)map.removeLayer(route);
 route=L.geoJSON(r.routes[0].geometry).addTo(map);
 steps=r.routes[0].legs[0].steps;
 stepIndex=0;
 speak(steps[0].maneuver.instruction);
 limit.textContent='45 mph';
}

function voiceSearch(){
 const r=new webkitSpeechRecognition();
 r.onresult=e=>{search.value=e.results[0][0].transcript;searchAddress();};
 r.start();
}

if('serviceWorker'in navigator)navigator.serviceWorker.register('service-worker.js');
</script>
</body>
</html>


<!-- ==========================
STEP 4: manifest.json
========================== -->
{
  "name":"Car GPS Navigation",
  "short_name":"CarGPS",
  "start_url":"./index.html",
  "display":"standalone",
  "background_color":"#000",
  "theme_color":"#000"
}


<!-- ==========================
STEP 5: service-worker.js
========================== -->
const CACHE='car-gps-v2';
self.addEventListener('install',e=>e.waitUntil(caches.open(CACHE).then(c=>c.addAll(['./','./index.html']))));
self.addEventListener('fetch',e=>e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request))));
